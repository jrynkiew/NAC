version: '2'

services:
  jrpc-linux-builder:
    container_name: jrpc-linux-builder
    #Uncomment this line to use a pre-built container If you do so, comment out the "build" section
    image: jrpc1/nac-linux-builder:latest
    # build: 
    #     context: ./
    #     dockerfile: Dockerfile-Linux-x64-Builder
    restart: "always"
    links:
      - "jenkins:server"
    volumes:
      - "$jrpc_beta_v2/:/src"
      - "./build-tests/:/build/tests/"
      - "./jenkins/:/build/jenkins-scripts/"
    environment:
      - CMAKE_VERSION=3.24.1
      - GLFW_VERSION=3.3.8
      - SDL_VERSION=2.26.2
      - BUILD_TARGET=linux
    networks:
      - jenkins_network
    command: "/build/jenkins-scripts/start-agent.sh"


  jrpc-windows-builder:
    container_name: jrpc-windows-builder
    #Uncomment this line to use a pre-built container If you do so, comment out the "build" section
    image: jrpc1/nac-windows-builder:latest
    # build: 
    #     context: ./
    #     dockerfile: Dockerfile-Windows-x32-Builder
    restart: "always"
    links:
      - "jenkins:server"
    volumes:
      - "$jrpc_beta_v2/:/src"
      - "./build-tests/:/build/tests/"
      - "./jenkins/:/build/jenkins-scripts/"
    environment:
      - CMAKE_VERSION=3.24.1
      - GLFW_VERSION=3.3.8
      - SDL_VERSION=2.26.2
      - BUILD_TARGET=windows
    networks:
      - jenkins_network
    command: "/build/jenkins-scripts/start-agent.sh"

  jrpc-web-builder:
    container_name: jrpc-web-builder
    #Uncomment this line to use a pre-built container If you do so, comment out the "build" section
    image: jrpc1/nac-web-builder:latest
    # build: 
    #     context: ./
    #     dockerfile: Dockerfile-Web-Builder
    links:
      - "jenkins:server"
    volumes:
      - "$jrpc_beta_v2/:/src"
      - "./build-tests/:/build/tests/"
      - "./jenkins/:/build/jenkins-scripts/"
    environment:
      - CMAKE_VERSION=3.24.1
      - GLFW_VERSION=3.3.8
      - SDL_VERSION=2.26.2
      - BUILD_TARGET=web
    networks:
      - jenkins_network
    command: "/build/jenkins-scripts/start-agent.sh"

  jenkins:
    image: jenkins/jenkins:lts
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - "$jrpc_beta_v2/build/jenkins/data:/var/jenkins_home"
    networks:
      - jenkins_network

networks:
  jenkins_network: